<div class="sessions-container">
  <div class="sessions-header">
    <h1>Virtual Classroom Management</h1>
    <p>Create and manage your teaching sessions</p>
  
    
    <!-- Stats Cards -->
    <div class="stats-grid">
      <div class="stat-card" data-stat="sessions">
        <div class="stat-icon">
          <i class="fas fa-video"></i>
        </div>
        <div class="stat-info">
          <h4>{{ sessions.length }}</h4>
          <p>Total Sessions</p>
          <div class="stat-detail">
            <span>Active: {{ getSessionCountByStatus('ongoing') }}</span>
            <span class="trend-up"><i class="fas fa-arrow-up"></i> {{ calculateActiveSessionChange() }}%</span>
          </div>
        </div>
      </div>
      
      <div class="stat-card" data-stat="students">
        <div class="stat-icon">
          <i class="fas fa-user-graduate"></i>
        </div>
        <div class="stat-info">
          <h4>{{ getTotalStudents() }}</h4>
          <p>Total Students</p>
          <div class="stat-detail">
            <span>Avg: {{ getAverageStudentsPerSession() }} per session</span>
            <span class="stat-chart"><i class="fas fa-chart-line"></i></span>
          </div>
        </div>
      </div>
      
      <div class="stat-card" data-stat="upcoming">
        <div class="stat-icon">
          <i class="fas fa-calendar-alt"></i>
        </div>
        <div class="stat-info">
          <h4>{{ getSessionCountByStatus('scheduled') }}</h4>
          <p>Upcoming Sessions</p>
          <div class="stat-detail">
            <span>Next: {{ getNextSessionDateString() }}</span>
            <span class="stat-time"><i class="fas fa-clock"></i></span>
          </div>
        </div>
      </div>
      
      <div class="stat-card" data-stat="completed">
        <div class="stat-icon">
          <i class="fas fa-check-circle"></i>
        </div>
        <div class="stat-info">
          <h4>{{ getSessionCountByStatus('completed') }}</h4>
          <p>Completed Sessions</p>
          <div class="stat-detail">
            <span>Hours: {{ getTotalTeachingHours() }}</span>
            <span class="stat-award"><i class="fas fa-award"></i></span>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Filter Container (student-style) -->
    <div class="filters-container">
      <div class="filters-header">
        <h3>Filter Sessions</h3>
        <div class="view-options">
          <button [ngClass]="{'active': viewMode === 'grid'}" (click)="viewMode = 'grid'">
            <i class="fas fa-th-large"></i>
          </button>
          <button [ngClass]="{'active': viewMode === 'list'}" (click)="viewMode = 'list'">
            <i class="fas fa-list"></i>
          </button>

        </div>
      </div>
      
      <div class="filters-grid">
        <!-- Status Filter -->
        <!--<div class="filter-item">
          <label>Status</label>
          <div class="status-filter-buttons">
            <button [ngClass]="{'active': statusFilter === 'all'}" 
                    (click)="statusFilter = 'all'; applyFilters()">All</button>
            <button [ngClass]="{'active': statusFilter === 'ongoing'}" 
                    (click)="statusFilter = 'ongoing'; applyFilters()">Live</button>
            <button [ngClass]="{'active': statusFilter === 'scheduled'}" 
                    (click)="statusFilter = 'scheduled'; applyFilters()">Upcoming</button>
            <button [ngClass]="{'active': statusFilter === 'completed'}" 
                    (click)="statusFilter = 'completed'; applyFilters()">Completed</button>
          </div>
        </div> -->
        
        <!-- Date Filter -->
        <div class="filter-item">
          <label>Date Range</label>
          <div class="date-filter">
            <div class="date-presets">
              <button [ngClass]="{'active': !dateRangeStart && !dateRangeEnd}" 
                      (click)="clearDateFilter(); applyFilters()">All</button>
              <button [ngClass]="{'active': isDatePresetActive('today')}" 
                      (click)="applyQuickFilter('today')">Today</button>
              <button [ngClass]="{'active': isDatePresetActive('thisWeek')}" 
                      (click)="applyQuickFilter('thisWeek')">This Week</button>
              <button [ngClass]="{'active': dateRangeStart && dateRangeEnd}" 
                      (click)="showCustomDateRange = !showCustomDateRange">Custom</button>
            </div>
            <div class="date-range" *ngIf="showCustomDateRange">
              <div class="date-input">
                <label>From</label>
                <input type="date" [(ngModel)]="dateRangeStart" (change)="applyFilters()">
              </div>
              <div class="date-input">
                <label>To</label>
                <input type="date" [(ngModel)]="dateRangeEnd" (change)="applyFilters()">
              </div>
            </div>
          </div>
        </div>
        
        <!-- Subject Filter -->
        <div class="filter-item">
          <label>Subject</label>
          <select [(ngModel)]="subjectFilter" (change)="applyFilters()">
            <option value="all">All Subjects</option>
            <option *ngFor="let subject of getUniqueSubjects()" [value]="subject">
              {{ subject }}
            </option>
          </select>
        </div>
        
        <!-- Duration Filter -->
        <div class="filter-item duration-filter">
          <label>Duration</label>
          <select [(ngModel)]="durationFilter" (change)="applyFilters()">
            <option value="all">Any Length</option>
            <option value="short">Short (< 60 min)</option>
            <option value="medium">Medium (60-120 min)</option>
            <option value="long">Long (> 120 min)</option>
          </select>
        </div>
        
        <!-- Sort Order -->
        <div class="filter-item">
          <label>Sort By</label>
          <select [(ngModel)]="sortOrder" (change)="applyFilters()">
            <option value="dateDesc">Newest First</option>
            <option value="dateAsc">Oldest First</option>
            <option value="titleAsc">Title (A-Z)</option>
            <option value="titleDesc">Title (Z-A)</option>
            <option value="studentsDesc">Most Students</option>
          </select>
        </div>
        
        <!-- Reset Filter -->
        <div class="filter-item reset-filter">
          <label>&nbsp;</label>
          <button class="reset-filters-btn" (click)="resetFilters()">
            Reset Filters
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Active Filters -->
  <div class="active-filters" *ngIf="hasActiveFilters()">
    <span class="active-filters-label">Active Filters:</span>
    <div class="filter-chips">
      <div class="filter-chip" *ngIf="statusFilter !== 'all'">
        Status: {{ statusFilter | titlecase }}
        <button class="remove-filter" (click)="statusFilter = 'all'; applyFilters()">×</button>
      </div>
      <div class="filter-chip" *ngIf="dateRangeStart || dateRangeEnd">
        Date Range: {{ getDateRangeDisplayText() }}
        <button class="remove-filter" (click)="clearDateFilter(); applyFilters()">×</button>
      </div>
      <div class="filter-chip" *ngIf="subjectFilter !== 'all'">
        Subject: {{ subjectFilter }}
        <button class="remove-filter" (click)="subjectFilter = 'all'; applyFilters()">×</button>
      </div>
      <div class="filter-chip" *ngIf="durationFilter !== 'all'">
        Duration: {{ getDurationDisplayText() }}
        <button class="remove-filter" (click)="durationFilter = 'all'; applyFilters()">×</button>
      </div>
      <div class="filter-chip" *ngIf="searchTerm.trim() !== ''">
        Search: {{ searchTerm }}
        <button class="remove-filter" (click)="searchTerm = ''; onSearchChange()">×</button>
      </div>
    </div>
  </div>
      <!-- Search bar (student-style) -->
      <div class="search-bar">
        <input type="text" [(ngModel)]="searchTerm" (input)="onSearchChange()" 
               placeholder="Search by title, subject, or description...">
        <button class="search-btn">
          <i class="fas fa-search"></i>
        </button>
      </div>
  <!-- Create Session Button
  <div class="create-session-container">
    <button class="create-session-btn" data-bs-toggle="modal" data-bs-target="#createSessionModal">
      <i class="fas fa-plus"></i> Create New Session
    </button>
  </div>  -->
  
  <!-- Loading indicator -->
  <div class="loading-container" *ngIf="loading">
    <div class="spinner"></div>
    <p>Loading your sessions...</p>
  </div>
  
  <!-- Error message -->
  <div class="error-container" *ngIf="error && !loading">
    <i class="fas fa-exclamation-triangle"></i>
    <p>{{ error }}</p>
    <button (click)="loadTeacherSessions()" class="retry-btn">Try Again</button>
  </div>
  
  <!-- No sessions found -->
  <div class="no-sessions" *ngIf="!loading && !error && filteredSessions.length === 0">
    <i class="fas fa-chalkboard"></i>
    <h2>No Sessions Found</h2>
    <p>You don't have any virtual classroom sessions matching your criteria.</p>
    <button class="create-session-btn mt-3" data-bs-toggle="modal" data-bs-target="#createSessionModal">
      <i class="fas fa-plus me-2"></i>Create Your First Session
    </button>
  </div>
  
  <!-- GRID VIEW: Sessions grid -->
  <div class="sessions-grid" *ngIf="!loading && !error && filteredSessions.length > 0 && viewMode === 'grid'">
    <div class="session-card" *ngFor="let session of filteredSessions" [attr.data-status]="session.status">

      <div class="session-content">
        <h2 class="session-title">{{ session.titleSession }}</h2>
        <p class="session-subject">{{ getSubjectDisplay(session.sessionSubject) }}</p>
        
        <div class="session-details">
          <div class="detail-item">
            <i class="far fa-calendar"></i>
            <span>{{ formatDate(session.startTime) }}</span>
          </div>
          <div class="detail-item">
            <i class="far fa-clock"></i>
            <span>{{ formatTime(session.startTime) }}</span>
          </div>
          <div class="detail-item">
            <i class="fas fa-hourglass-half"></i>
            <span>{{ getDurationDisplay(session) }}</span>
          </div>
          <div class="detail-item">
            <i class="fas fa-users"></i>
            <span>{{ session.enrolledStudents || 0 }} students</span>
            <div class="progress ms-2" style="width: 60px; height: 5px;">
              <div class="progress-bar" role="progressbar" 
                [style.width.%]="getCapacityPercentage(session)" 
                aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">
              </div>
            </div>
          </div>
        </div>
        
        <p class="session-description">{{ session.description || 'No description available' }}</p>
        
 <!-- In grid view session card - update the session-menu-button to a dropdown -->
 <div class="session-actions">
  <!-- For ongoing or scheduled sessions - External link -->
  <!-- Remove conditional display based on status and use a single button for all sessions -->
  <a [routerLink]="['/teacher/session-review', session.idSession]"
     class="join-btn" 
     [ngClass]="{'join-live': session.status === 'ongoing', 
                'join-upcoming': session.status === 'scheduled',
                'join-completed': session.status === 'completed'}">
    <i class="fas fa-video me-2"></i>
    {{ session.status === 'ongoing' ? 'Join Session' : 
       session.status === 'scheduled' ? 'Prepare Session' : 'Review Session' }}
  </a>
  
  <!-- For completed sessions - Angular router link -->
  <a *ngIf="session.status === 'completed'"
     [routerLink]="['/teacher/session-review', session.idSession]"
     class="join-btn join-completed">
    <i class="fas fa-clipboard-list me-2"></i> Review Session
  </a>
  
  <!-- Replace the menu button with these action buttons -->
  <div class="action-buttons">
    <button class="btn btn-sm btn-primary me-1" (click)="editSession(session)">
      <i class="fas fa-edit"></i>
    </button>
    <button class="btn btn-sm btn-danger" (click)="deleteSession(session)">
      <i class="fas fa-trash"></i>
    </button>
  </div>


    </div>

      </div>
    </div>
  </div>
  
  <!-- LIST VIEW: Sessions table -->
  <div *ngIf="!loading && !error && filteredSessions.length > 0 && viewMode === 'list'">
    <table class="sessions-table">
      <thead>
        <tr>
          <th>Title & Subject</th>
          <th>Date & Time</th>
          <th>Students</th>
          <th></th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let session of filteredSessions">
          <td>
            <div class="session-table-info">
              <div class="subject-dot" [ngStyle]="{'background-color': getSubjectColor(session.sessionSubject)}"></div>
              <div>
                <div class="session-table-title">{{ session.titleSession }}</div>
                <div class="session-table-subject">{{ getSubjectDisplay(session.sessionSubject) }}</div>
              </div>
            </div>
          </td>
          <td>
            <div class="session-table-date">{{ formatDate(session.startTime) }}</div>
            <div class="session-table-time">{{ formatTime(session.startTime) }}</div>
          </td>
          <td>
            <div class="session-table-students">
              <span>{{ session.enrolledStudents || 0 }}</span>
              <div class="progress">
                <div class="progress-bar" [style.width.%]="getCapacityPercentage(session)"></div>
              </div>
            </div>
          </td>
          <td>
            <span class="status-badge" 
                  [ngClass]="{'status-live': session.status === 'ongoing', 
                            'status-upcoming': session.status === 'scheduled', 
                            'status-completed': session.status === 'completed'}">
              {{ session.status | titlecase }}
            </span>
          </td>
          <td>
<!-- In list view - update the action buttons -->
<div class="table-actions">
  <a *ngIf="session.status === 'ongoing' || session.status === 'scheduled'"
     [href]="session.zoomLink || '#'" 
     target="_blank" 
     class="table-action-btn primary">
    <i class="fas fa-video"></i>
  </a>
  
  <!-- For completed sessions - Angular router link -->
  <a *ngIf="session.status === 'completed'"
     [routerLink]="['/teacher/session-review', session.idSession]"
     class="table-action-btn primary">
    <i class="fas fa-clipboard-list"></i>
  </a>

  <button class="table-action-btn secondary" (click)="editSession(session)">
    <i class="fas fa-edit"></i>
  </button>
  <button class="table-action-btn danger" (click)="deleteSession(session)">
    <i class="fas fa-trash"></i>
  </button>
  </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  
  <!-- CALENDAR VIEW: Placeholder for calendar -->
  <div *ngIf="!loading && !error && viewMode === 'calendar'" class="calendar-container">
    <div class="calendar-placeholder">
      <i class="far fa-calendar-alt"></i>
      <h3>Calendar View</h3>
      <p>Sessions would be displayed in a calendar format.</p>
    </div>
  </div>
  
  <!-- Floating create button -->
  <button class="floating-create-btn" data-bs-toggle="modal" data-bs-target="#createSessionModal">
    <i class="fas fa-plus"></i>
  </button>



    <!-- Add this at the end of your component HTML, just before the closing </div> -->
  <!-- Toast notification -->
  <div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div class="toast show fancy-toast" [ngClass]="'toast-' + toastType" *ngIf="showToast">
      <div class="toast-header">
        <i class="fas fa-{{toastIcon}} me-2"></i>
        <strong class="me-auto">{{ toastTitle }}</strong>
        <button type="button" class="btn-close" (click)="showToast = false"></button>
      </div>
      <div class="toast-body">
        {{ toastMessage }}
      </div>
    </div>
  </div>
  </div>

  <!-- Create Session Modal -->
    <div class="modal fade" id="createSessionModal" tabindex="-1" aria-labelledby="createSessionModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content border-0">
  <!-- Update the modal title -->
  <div class="modal-header border-0" style="background: linear-gradient(135deg, #7F7FD5, #86A8E7, #91EAE4); color: white;">
  <h5 class="modal-title" id="createSessionModalLabel">
    <i class="fas" [ngClass]="isEditing ? 'fa-edit' : 'fa-chalkboard-teacher'" class="me-2"></i>
    {{ isEditing ? 'Edit' : 'Create New' }} Classroom Session
  </h5>
  <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
  </div>
      
      <!-- Modal body with styled form -->
      <div class="modal-body p-4">
        <form [formGroup]="sessionForm" (ngSubmit)="createSession()">
          <div class="row g-4">
            <!-- Title with floating label -->
            <div class="col-12">
              <div class="form-floating">
                <input 
                  type="text" 
                  class="form-control" 
                  id="titleSession" 
                  formControlName="titleSession"
                  placeholder="Enter session title"
                  [ngClass]="{'is-invalid': sessionForm.get('titleSession')?.invalid && sessionForm.get('titleSession')?.touched}">
                <label for="titleSession">Session Title <span class="text-danger">*</span></label>
                <div class="invalid-feedback">
                  Please enter a title for your classroom session
                </div>
              </div>
            </div>
            
            <!-- Replace the subject select element with this input text field -->
            <div class="col-md-6">
              <div class="form-floating">
                <input 
                  type="text" 
                  class="form-control" 
                  id="sessionSubject" 
                  formControlName="sessionSubject"
                  placeholder="Enter subject"
                  list="subjectSuggestions"
                  [ngClass]="{'is-invalid': sessionForm.get('sessionSubject')?.invalid && sessionForm.get('sessionSubject')?.touched}">
                <datalist id="subjectSuggestions">
                  <option value="Mathematics"></option>
                  <option value="Science"></option>
                  <option value="History"></option>
                  <option value="English"></option>
                  <option value="Computer Science"></option>
                  <option value="Programming"></option>
                  <option value="Art"></option>
                  <option value="General"></option>
                </datalist>
                <label for="sessionSubject">Subject <span class="text-danger">*</span></label>
                <div class="invalid-feedback">
                  Please enter a subject for your session
                </div>
              </div>
            </div>
            
            <!-- Date with date picker -->
            <div class="col-md-6">
              <div class="form-floating">
                <input 
                  type="date" 
                  class="form-control" 
                  id="startDate" 
                  formControlName="startDate"
                  [min]="today"
                  [ngClass]="{'is-invalid': sessionForm.get('startDate')?.invalid && sessionForm.get('startDate')?.touched}">
                <label for="startDate">Session Date <span class="text-danger">*</span></label>
                <div class="invalid-feedback">
                  Please select a valid date
                </div>
              </div>
            </div>
            
            <!-- Time with time picker -->
            <div class="col-md-6">
              <div class="form-floating">
                <input 
                  type="time" 
                  class="form-control" 
                  id="startTime" 
                  formControlName="startTime"
                  [ngClass]="{'is-invalid': sessionForm.get('startTime')?.invalid && sessionForm.get('startTime')?.touched}">
                <label for="startTime">Start Time <span class="text-danger">*</span></label>
                <div class="invalid-feedback">
                  Please select a start time
                </div>
              </div>
            </div>
            
            <!-- Duration with number spinner -->
            <div class="col-md-6">
              <div class="form-floating">
                <input 
                  type="number" 
                  class="form-control" 
                  id="sessionDuration" 
                  formControlName="sessionDuration"
                  min="15" 
                  max="360"
                  [ngClass]="{'is-invalid': sessionForm.get('sessionDuration')?.invalid && sessionForm.get('sessionDuration')?.touched}">
                <label for="sessionDuration">Duration (minutes) <span class="text-danger">*</span></label>
                <div class="invalid-feedback">
                  Please enter a duration between 15 and 360 minutes
                </div>
              </div>
            </div>
            
            <!-- Description text area -->
            <div class="col-12">
              <div class="form-floating">
                <textarea 
                  class="form-control" 
                  id="description" 
                  formControlName="description"
                  placeholder="Enter a description"
                  style="height: 100px"></textarea>
                <label for="description">Description (optional)</label>
              </div>
              <div class="form-text">
                Briefly describe what this session will cover
              </div>
            </div>
            
            <!-- Zoom meeting link -->
            <div class="col-12">
              <div class="form-floating">
                <input 
                  type="url" 
                  class="form-control" 
                  id="zoomLink" 
                  formControlName="zoomLink"
                  placeholder="Enter meeting URL"
                  [ngClass]="{'is-invalid': sessionForm.get('zoomLink')?.invalid && sessionForm.get('zoomLink')?.touched}">
                <label for="zoomLink">Meeting Link (optional)</label>
                <div class="invalid-feedback">
                  Please enter a valid URL (e.g., https://zoom.us/j/123456789)
                </div>
              </div>
              <div class="form-text">
                <i class="fas fa-info-circle me-1 text-info"></i>
                Share your Zoom, Google Meet or Microsoft Teams link
              </div>
            </div>
          </div>
        </form>
        
        <!-- Required fields note -->
        <div class="mt-3 small text-muted">
          <span class="text-danger">*</span> Required fields
        </div>
      </div>
      
<!-- Update the save button -->
<div class="modal-footer border-0 pt-0">
  <button type="button" class="btn btn-light" data-bs-dismiss="modal">
    <i class="fas fa-times me-1"></i> Cancel
  </button>
  <button 
    type="button" 
    class="btn btn-primary" 
    [disabled]="sessionForm.invalid" 
    (click)="saveSession()">
    <i class="fas" [ngClass]="isEditing ? 'fa-save' : 'fa-plus'" class="me-1"></i>
    {{ isEditing ? 'Update' : 'Create' }} Session
  </button>
</div>
    </div>
  </div>
</div>