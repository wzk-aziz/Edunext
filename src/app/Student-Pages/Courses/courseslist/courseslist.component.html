<main>
  <!-- =======================
       Page Banner START -->
  <section class="bg-dark align-items-center d-flex" style="background:url(/assets/images/pattern/04.png) no-repeat center center; background-size:cover;">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <h1 class="text-white">Discover Our Courses</h1>
          <div class="d-flex">
            <nav aria-label="breadcrumb">
              <ol class="breadcrumb breadcrumb-dark breadcrumb-dots mb-0">
                <li class="breadcrumb-item"><a routerLink="/studenthome">Home</a></li>
                <li class="breadcrumb-item active" aria-current="page">Courses</li>
              </ol>
            </nav>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- =======================
       Page Banner END -->
    
  <!-- =======================
       Page content START -->
  <section class="pb-0 py-sm-5">
    <div class="container">
      <!-- Title and select START -->
      <div class="row g-3 align-items-center mb-4">
        <div class="col-md-4">
          <h4 class="mb-0">
            Showing {{ startIndex }} - {{ endIndex }} of {{ courses.length }} result{{ courses.length !== 1 ? 's' : '' }}
          </h4>
        </div>
        <div class="col-md-3">
          <input type="text" class="form-control" placeholder="Insert course name ..." (input)="searchCoursesByName($event)">
        </div>
        <div class="col-md-5">
          <div class="row g-3 align-items-center justify-content-md-end me-auto">
            <form class="col-md-4 bg-body shadow rounded p-1 input-borderless">
              <select class="form-select js-choice z-index-9" aria-label=".form-select-sm" (change)="sortCourses($event)">
                <option value="">Sort by</option>
                <option value="free">Free</option>
                <option value="newest">Newest</option>
                <option value="most-popular">Most popular</option>
                <option value="most-viewed">Most Viewed</option>
              </select>
            </form>
          </div>
        </div>
      </div>
      <!-- Title and select END -->
    
      <div class="row">
        <!-- Main content START -->
        <div class="col-xl-9 col-xxl-8">
    
          <!-- Course list START -->
          <div class="row g-4">
            <!-- Card list START -->
            <div class="col-12" *ngFor="let course of courses | paginate: { itemsPerPage: 3, currentPage: page }">
              <!-- Course card -->
              <div class="card shadow overflow-hidden p-2 hover-effect">
                <div class="row g-0">
                  <!-- Thumbnail Column -->
                  <div class="col-md-5 overflow-hidden thumbnail-container">
                    <img *ngIf="course.thumbnailData" 
                         [src]="'data:image/png;base64,' + course.thumbnailData"
                         class="rounded-2 thumbnail-image" 
                         alt="Course Thumbnail">
                    <div class="card-img-overlay">
                      <div class="ribbon" [ngClass]="getPackRibbonClass(course)">
                        <span>{{ getPackTypeText(course) }}</span>
                      </div>
                    </div>
                  </div>
    
                  <!-- Content Column -->
                  <div class="col-md-7">
                    <div class="card-body">
                      <!-- Category & Average Rating Display -->
                      <div class="d-flex justify-content-between align-items-center mb-2">
                        <a href="#" [ngClass]="getCategoryBadgeClass(course)" class="badge mb-2 mb-sm-0">
                          {{ course.category?.name || 'N/A' }}
                        </a>
                        <div>
                            <!-- Like button -->
            <button class="btn btn-link p-0" (click)="likeCourse(course.id!)">
              <i class="fas fa-heart text-danger"></i> {{ course.likes || 0 }}
            </button>
            <!-- Dislike button -->
            <button class="btn btn-link p-0 ms-2" (click)="dislikeCourse(course.id!)">
              <i class="fas fa-thumbs-down text-secondary"></i> {{ course.dislikes || 0 }}
            </button>
                        </div>
                      </div>
    
                      <!-- Course Title & Description -->
                      <h5 class="card-title">
                        <a [routerLink]="['/course-detail', course.id]">{{ course.courseName }}</a>
                      </h5>
                      <p class="text-truncate-2 d-none d-lg-block">{{ course.courseDescription }}</p>
    
                      <!-- Course Metadata -->
                      <ul class="list-inline">
                        <li class="list-inline-item h6 fw-light mb-1 mb-sm-0">
                          <i class="far fa-clock text-danger me-2"></i>{{ course.duration }}h
                        </li>
                        <li class="list-inline-item h6 fw-light mb-1 mb-sm-0">
                          <i class="fas fa-table text-orange me-2"></i>{{ course.numberOfLectures }} lectures
                        </li>
                        <li class="list-inline-item h6 fw-light">
                          <i [ngClass]="getSignalClass(course)"></i>
                          {{ getCourseLevelText(course) }}
                        </li>
                      </ul>
    
                     <!-- Star rating display -->
        <div class="mb-2">
          <ng-container *ngFor="let star of getRatingStars(course)">
            <i class="fa" [ngClass]="star ? 'fa-star text-warning' : 'fa-star-o text-secondary'"></i>
          </ng-container>
          <!-- e.g. display ratio-based rating -->
          <small>({{ (course.likes || 0) + ' likes out of ' + ((course.likes || 0) + (course.dislikes || 0)) + ' votes' }})</small>
        </div>
    
                      <!-- Action Button -->
                      <div class="d-sm-flex justify-content-sm-between align-items-center mt-3">
                        <div>
                          <a [routerLink]="['/coursedetail', course.id]" class="btn btn-dark">View more</a>
                        </div>
                      </div>
    
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- Card list END -->
          </div>
          <!-- Course list END -->
    
          <div class="col-12">         
            <!-- Additional content if needed -->
          </div>
          <!-- Course list END -->
    
          <div class="col-12">
            <nav class="mt-4 d-flex justify-content-center" aria-label="navigation">
              <ul class="pagination pagination-primary-soft rounded mb-0">
                <!-- First Page -->
                <li class="page-item" [class.disabled]="page === 1">
                  <a class="page-link" href="#" tabindex="-1" (click)="setPage(1, $event)">
                    <i class="fas fa-angle-double-left"></i>
                  </a>
                </li>
                <!-- Page Numbers -->
                <li class="page-item" *ngFor="let p of pagesArray" [class.active]="p === page">
                  <a class="page-link" href="#" (click)="setPage(p, $event)">{{ p }}</a>
                </li>
                <!-- Last Page -->
                <li class="page-item" [class.disabled]="page === totalPages">
                  <a class="page-link" href="#" (click)="setPage(totalPages, $event)">
                    <i class="fas fa-angle-double-right"></i>
                  </a>
                </li>
              </ul>
            </nav>
          </div>
    
        </div>
        <!-- Main content END -->
    
        <!-- Right sidebar START -->
        <div class="col-lg-3 col-xxl-4 pt-5 pt-lg-0">
          <!-- Responsive offcanvas body START -->
          <nav class="navbar navbar-light navbar-expand-xl mx-0">
            <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
              <div class="offcanvas-header bg-light">
                <h5 class="offcanvas-title" id="offcanvasNavbarLabel">Advance Filter</h5>
                <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
              </div>
              <div class="offcanvas-body p-3 p-xl-0">
                <form>
                  <!-- Price START -->
                  <div class="card card-body shadow p-4 mb-4">
                    <h4 class="mb-3">Price Level</h4>
                    <ul class="list-inline mb-0">
                      <li class="list-inline-item">
                        <input type="radio" class="btn-check" name="options" id="option1">
                        <label class="btn btn-light btn-primary-soft-check" for="option1">All</label>
                      </li>
                      <li class="list-inline-item">
                        <input type="radio" class="btn-check" name="options" id="option2">
                        <label class="btn btn-light btn-primary-soft-check" for="option2">Copper</label>
                      </li>
                      <li class="list-inline-item">
                        <input type="radio" class="btn-check" name="options" id="option3">
                        <label class="btn btn-light btn-primary-soft-check" for="option3">Bronze</label>
                      </li>
                      <li class="list-inline-item">
                        <input type="radio" class="btn-check" name="options" id="option4">
                        <label class="btn btn-light btn-primary-soft-check" for="option4">Silver</label>
                      </li>
                      <li class="list-inline-item">
                        <input type="radio" class="btn-check" name="options" id="option5">
                        <label class="btn btn-light btn-primary-soft-check" for="option5">Gold</label>
                      </li>
                    </ul>
                  </div>
                  <!-- Price END -->
                  <!-- Skill level START -->
                  <div class="card card-body shadow p-4 mb-4">
                    <h4 class="mb-3">Skill level</h4>
                    <ul class="list-inline mb-0">
                      <li class="list-inline-item mb-2">
                        <input type="checkbox" class="btn-check" id="btn-check-12" (change)="searchCoursesByCourseLevel(CourseLevel.ALL_LEVELS)">
                        <label class="btn btn-light btn-primary-soft-check" for="btn-check-12">All levels</label>
                      </li>
                      <li class="list-inline-item mb-2">
                        <input type="checkbox" class="btn-check" id="btn-check-9" (change)="searchCoursesByCourseLevel(CourseLevel.BEGINNER)">
                        <label class="btn btn-light btn-primary-soft-check" for="btn-check-9">Beginner</label>
                      </li>
                      <li class="list-inline-item mb-2">
                        <input type="checkbox" class="btn-check" id="btn-check-10" (change)="searchCoursesByCourseLevel(CourseLevel.INTERMEDIATE)">
                        <label class="btn btn-light btn-primary-soft-check" for="btn-check-10">Intermediate</label>
                      </li>
                      <li class="list-inline-item mb-2">
                        <input type="checkbox" class="btn-check" id="btn-check-11" (change)="searchCoursesByCourseLevel(CourseLevel.ADVANCED)">
                        <label class="btn btn-light btn-primary-soft-check" for="btn-check-11">Advanced</label>
                      </li>
                    </ul>
                  </div>
                </form><!-- Form End -->
              </div>
              <!-- Button -->
              <div class="d-grid p-2 p-xl-0 bg-body text-center">
                <button class="btn btn-primary mb-0" (click)="loadCourses()">Remove Filter </button>
              </div>
            </div>
          </nav>
          <!-- Responsive offcanvas body END -->
        </div>
        <!-- Right sidebar END -->
    
      </div><!-- Row END -->
    </div>
  </section>
  <style>
    .thumbnail-image:hover {
      transform: scale(1.05);
      transition: transform 0.3s ease;
    }
  </style>
</main>

<div class="container my-5">
  <h2 class="text-center mb-4">Most Liked Courses</h2>
  <div id="mostLikedCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="4000" data-bs-pause="hover">
    <div class="carousel-inner">
      <div *ngFor="let course of mostLikedCourses; let i = index" class="carousel-item" [class.active]="i === 0">
        <div class="card border-0 shadow-sm mx-auto" style="max-width: 300px;">
          <img *ngIf="course.thumbnailData" [src]="'data:image/png;base64,' + course.thumbnailData" class="card-img-top" alt="Course Thumbnail">
          <div class="card-body text-center">
            <h5 class="card-title">{{ course.courseName }}</h5>
            <p class="card-text small">
              <i class="fas fa-heart text-danger me-1"></i>{{ course.likes || 0 }} likes
            </p>
            <a [routerLink]="['/course-detail', course.id]" class="btn btn-primary btn-sm">View Course</a>
          </div>
        </div>
      </div>
    </div>
    <!-- Carousel controls -->
    <button class="carousel-control-prev" type="button" data-bs-target="#mostLikedCarousel" data-bs-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#mostLikedCarousel" data-bs-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Next</span>
    </button>
  </div>
</div>
