<main>

  <!-- =======================
  Page Banner START -->
  <section class="bg-dark align-items-center d-flex" style="background:url(/assets/images/pattern/04.png) no-repeat center center; background-size:cover;">
    <!-- Main banner background image -->
    <div class="container">
      <div class="row">
        <div class="col-12">
          <!-- Title -->
          <h1 class="text-white">Marketplace</h1>
          <!-- Breadcrumb -->
          <div class="d-flex">
            <nav aria-label="breadcrumb">
              <ol class="breadcrumb breadcrumb-dark breadcrumb-dots mb-0">
                <li class="breadcrumb-item"><a routerLink="/studenthome">Home</a></li>
                <li class="breadcrumb-item active" aria-current="page">Marketplace</li>
              </ol>
            </nav>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- =======================
  Page Banner END -->

  <!-- =======================
  Page content START -->
  <section class="pb-0 py-sm-5">
    <div class="container">
      <!-- Title and select START -->
      <div class="row g-3 align-items-center mb-4">
        <!-- Content -->
        <h3 style="font-size: 24px; text-align: left; margin-top: 20px;">
          Products Displayed: {{ paginatedProducts.length }} / {{ products.length }}
        </h3>

        <!-- Select option -->
        <div class="col-md-8">
          <div class="row g-3 align-items-center justify-content-md-end me-auto">

            <!-- List and Grid icon -->
            <div class="col-sm-4 col-xl-6 text-md-end d-none d-md-block">
              <ul class="list-inline mb-0">
                <!-- Grid icon -->
                <li class="list-inline-item"><a href="course-grid.html" class="btn btn-outline-light mb-0 me-2"><i class="fas fa-fw fa-th-large"></i></a></li>
                <!-- list icon -->
                <li class="list-inline-item"><a href="course-list.html" class="btn btn-outline-light mb-0 me-2"><i class="fas fa-fw fa-list-ul"></i></a></li>
              </ul>
            </div>

            <!-- Short by filter -->
            <form class="col-md-4 bg-body shadow rounded p-1 input-borderless">
              <select class="form-select js-choice z-index-9" aria-label=".form-select-sm">
                <option value="">Sort by</option>
                <option>Free</option>
                <option>Newest</option>
                <option>Most popular</option>
                <option>Most Viewed</option>
              </select>
            </form>

            <!-- Advanced filter responsive toggler START -->
            <div class="col-4 d-xl-none text-md-end">
              <button class="btn btn-primary mb-0" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar">
                <i class="fas fa-sliders-h me-1"></i> Show filter
              </button>
            </div>
            <!-- Advanced filter responsive toggler END -->

          </div>
        </div>
      </div>
      <!-- Title and select END -->

      <div class="row">
        <!-- Main content START -->
        <div class="col-xl-9 col-xxl-8">



          <form [formGroup]="searchProductForm">
            <input formControlName="title" type="text" placeholder="Search for a product..." class="search-input" (input)="onSearchChange()">
          </form>
          <!-- Barre de recherche END -->

          <div>
            <form [formGroup]="filterForm" (ngSubmit)="applyFilters()">
              <select formControlName="category" (change)="applyFilters()">
                <option *ngFor="let category of categories" [value]="category.id">{{ category.name }}</option>
              </select>

              <select formControlName="sortBy" (change)="applyFilters()">
                <option value="name">Sort by Name</option>
                <option value="price">Sort by Price</option>
                <option value="rating">Sort by Rating</option>
              </select>
            </form>
          </div>
          <!-- Course list START -->

          <!-- Affichage des produits -->
          <div class="row g-4 mt-4">
          <div *ngIf="paginatedProducts.length > 0; else noProducts">
              <div *ngFor="let product of paginatedProducts" class="col-12">
                <div class="card shadow overflow-hidden p-2">
                  <div class="row g-0">
                    <div class="col-md-5 overflow-hidden">
                      <img [src]="product.processedImg" alt="{{ product.name }}" class="rounded-2">
                      <div class="card-img-overlay">
                        <div class="ribbon">
                          <span>{{ product.isFree ? 'Free' : product.price + '€' }}</span>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-7">
                      <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                          <a class="badge bg-primary text-white mb-2 mb-sm-0">{{ product.categoryName }}</a>
                        </div>
                        <h1 class="card-title"><a>{{ product.name }}</a></h1>
                        <p class="text-truncate-2 d-none d-lg-block">{{ product.description }}</p>
                        <div class="ribbon text-white">
                          <span *ngIf="product.isFree" class="bg-success px-2 py-1 rounded-3">Free</span>
                          <span *ngIf="!product.isFree" class="bg-danger px-2 py-1 rounded-3">{{ product.price }}€</span>
                        </div>
                        <div class="mt-3 d-flex justify-content-between align-items-center">
                          <!-- Boutons Add to Cart et Wishlist -->
                          <a (click)="addToWishlist(product.id)" style="cursor:pointer;">
                            <i [class.fas]="true"
                               [class.fa-heart]="!isInWishlist(product.id)"
                            [class.fa-heart-broken]="isInWishlist(product.id)"
                            [class.text-danger]="isInWishlist(product.id)"
                            [class.text-warning]="!isInWishlist(product.id)"
                            class="fs-5">
                            </i>
                          </a>

                          <button (click)="addToCart(product.id)" class="btn px-3 py-1 d-flex align-items-center gap-2 position-relative" style="background-color: #78a93c; color: white; border: none; transition: all 0.5s ease-in-out; border-radius: 8px; font-size: 14px;">
                            <i class="fas fa-shopping-cart"></i>
                            <span>Add to Cart</span>
                          </button>
                        </div>

                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <ng-template #noProducts>
              <p>No products available.</p>
            </ng-template>
          </div>

          <!-- Pagination -->
          <div class="col-12">
            <nav class="mt-4 d-flex justify-content-center" aria-label="navigation">
              <ul class="pagination pagination-primary-soft rounded mb-0">
                <li class="page-item mb-0" [class.disabled]="currentPage === 1">
                  <a class="page-link" (click)="changePage(currentPage - 1)" tabindex="-1">
                    <i class="fas fa-angle-double-left"></i>
                  </a>
                </li>
                <li *ngFor="let page of getPages()" class="page-item mb-0" [class.active]="page === currentPage">
                  <a class="page-link" (click)="changePage(page)">{{ page }}</a>
                </li>
                <li class="page-item mb-0" [class.disabled]="currentPage === totalPages">
                  <a class="page-link" (click)="changePage(currentPage + 1)">
                    <i class="fas fa-angle-double-right"></i>
                  </a>
                </li>
              </ul>
            </nav>
          </div>




        </div>
        <!-- Main content END -->

        <!-- Right sidebar START -->
        <div class="col-lg-3 col-xxl-4 pt-5 pt-lg-0">
          <!-- Responsive offcanvas body START -->
          <nav class="navbar navbar-light navbar-expand-xl mx-0">
            <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
              <div class="offcanvas-header bg-light">
                <h5 class="offcanvas-title" id="offcanvasNavbarLabel">Advance Filter</h5>
                <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
              </div>
              <div class="offcanvas-body p-3 p-xl-0">
                <form>
                </form><!-- Form End -->
              </div>


            </div>
          </nav>
          <!-- Responsive offcanvas body END -->
        </div>
        <!-- Right sidebar END -->

      </div><!-- Row END -->
    </div>
  </section>
