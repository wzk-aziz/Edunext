<!-- Add this at the top of your progress-report.component.html file, 
     right after the opening <div class="progress-report-container"> -->
<canvas #confettiCanvas class="confetti-canvas"></canvas>

<div class="progress-report-container">
  <h2>Progress Reports Management</h2>
  
  <!-- Show loading indicator -->
  <div class="loading-indicator" *ngIf="loading">
    <p>Loading...</p>
  </div>
  
  <!-- Show error message -->
  <div class="error-message" *ngIf="error">
    <p>{{ error }}</p>
  </div>

    <!-- Add this after your error message div -->
  <div *ngIf="error && paginatedReports && paginatedReports.length > 0" class="warning-but-working">
    <p>Warning: {{ error }}</p>
    <p>However, some progress reports were still loaded and are displayed below.</p>
  </div>

  <!-- Button to add a new progress report -->
  <div class="add-report-container">
    <button class="add-button" (click)="showAddProgressReportForm()" *ngIf="showProgressReportList">Add New Progress Report</button>
  </div>
  
  <!-- Progress report list -->
  <div class="progress-report-list" *ngIf="showProgressReportList">
    <!-- Search and filters -->
    <div class="filters-container">
      <div class="search-filter">
        <input type="text" class="search-bar" placeholder="Search by content, learner ID, program ID..." 
               [(ngModel)]="searchTerm" (input)="filterProgressReports()">
      </div>
      
      <div class="advanced-filters">
        <details>
          <summary>Advanced Filters</summary>
          <div class="filter-options">
            <div>
              <label>Content Search:</label>
              <input type="text" [(ngModel)]="filters.contentSearch" placeholder="Search content" (input)="filterProgressReports()">
            </div>
            
            <div>
              <label>Date Range:</label>
              <div class="range-filter">
                <input type="date" [(ngModel)]="filters.dateFrom" (change)="filterProgressReports()">
                <span>to</span>
                <input type="date" [(ngModel)]="filters.dateTo" (change)="filterProgressReports()">
              </div>
            </div>
            
            <button class="btn-square btn-delete" (click)="clearFilters()">üóëÔ∏è</button>
          </div>
        </details>
      </div>
    </div>
    
    <!-- Progress report table -->
    <table *ngIf="filteredProgressReports && filteredProgressReports.length > 0">
      <thead>
        <tr>
          <th>ID</th>
          <th>Content</th>
          <th>Date</th>
          <th>Learner ID</th>
          <th>Program ID</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <!-- Change from filteredProgressReports to paginatedReports -->
        <tr *ngFor="let report of paginatedReports">
          <td>{{ report.idReport }}</td>
          <td>{{ report.reportContent }}</td>
          <td>{{ report.reportDate | date:'medium' }}</td>
          <td>{{ report.learnerId }}</td>
          <td>{{ report.mentorshipProgramId }}</td>
          <td>
            <div class="button-container">
              <button class="btn-square btn-edit" (click)="selectProgressReport(report)" title="Edit">‚úèÔ∏è</button>
              <button class="btn-square btn-delete" (click)="deleteProgressReport(report.idReport)" title="Delete">üóëÔ∏è</button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
    
    <!-- Add pagination controls -->
    <!-- Replace the current pagination-controls div with this -->
    <div class="pagination-controls" *ngIf="filteredProgressReports && filteredProgressReports.length > 0">
      <div class="pagination-info">
        Showing {{ (currentPage - 1) * pageSize + 1 }} to 
        {{ Math.min(currentPage * pageSize, filteredProgressReports.length) }} 
        of {{ filteredProgressReports.length }} progress reports
      </div>
      
      <div class="page-size">
        <label>Items per page:</label>
        <select [(ngModel)]="pageSize" (change)="changePageSize(pageSize)">
          <option *ngFor="let size of pageSizeOptions" [value]="size">{{ size }}</option>
        </select>
      </div>
      
      <div class="page-navigation">
        <button [disabled]="currentPage === 1" (click)="prevPage()" class="btn-nav">
          &laquo; Previous
        </button>
        <span class="page-indicator">{{ currentPage }} / {{ Math.ceil(filteredProgressReports.length / pageSize) || 1 }}</span>
        <button [disabled]="currentPage >= Math.ceil(filteredProgressReports.length / pageSize)" (click)="nextPage()" class="btn-nav">
          Next &raquo;
        </button>
      </div>
    </div>
    
    <!-- No reports found message -->
    <p *ngIf="!filteredProgressReports || filteredProgressReports.length === 0">No progress reports found</p>
  </div>


  <!-- Edit progress report form -->
  <div class="progress-report-edit" *ngIf="selectedProgressReport && !showCreateForm && !showProgressReportList">
    <h3>Edit Progress Report</h3>
    <form (ngSubmit)="updateProgressReport()" #editReportForm="ngForm">
      <div>
        <label for="edit-content">Content: <span class="required-field">*</span></label>
        <input id="edit-content" [(ngModel)]="selectedProgressReport.reportContent" 
               name="editContent" required minlength="3" #editContent="ngModel"
               [class.error-field]="editContent.invalid && (editContent.dirty || editContent.touched || formSubmitted)">
        <div *ngIf="editContent.invalid && (editContent.dirty || editContent.touched || formSubmitted)" class="error">
          <div *ngIf="editContent.errors?.['required']">Content is required.</div>
          <div *ngIf="editContent.errors?.['minlength']">Content must be at least 3 characters long.</div>
        </div>
      </div>
      
      <div>
        <label for="edit-reportDate">Report Date: <span class="required-field">*</span></label>
        <input id="edit-reportDate" type="date" [(ngModel)]="selectedReportDateString" 
               name="editReportDate" required #editReportDate="ngModel"
               [class.error-field]="editReportDate.invalid && (editReportDate.dirty || editReportDate.touched || formSubmitted)">
        <div *ngIf="editReportDate.invalid && (editReportDate.dirty || editReportDate.touched || formSubmitted)" class="error">
          <div *ngIf="editReportDate.errors?.['required']">Report Date is required.</div>
        </div>
      </div>
      
      <div>
        <label for="edit-learnerId">Learner ID: <span class="required-field">*</span></label>
        <input id="edit-learnerId" type="number" [(ngModel)]="selectedProgressReport.learnerId" 
               name="editLearnerId" required min="1" #editLearnerId="ngModel"
               [class.error-field]="editLearnerId.invalid && (editLearnerId.dirty || editLearnerId.touched || formSubmitted)">
        <div *ngIf="editLearnerId.invalid && (editLearnerId.dirty || editLearnerId.touched || formSubmitted)" class="error">
          <div *ngIf="editLearnerId.errors?.['required']">Learner ID is required.</div>
          <div *ngIf="editLearnerId.errors?.['min']">Learner ID must be at least 1.</div>
        </div>
      </div>
      
      <div>
        <label for="edit-programId">Mentorship Program ID: <span class="required-field">*</span></label>
        <input id="edit-programId" type="number" [(ngModel)]="selectedProgressReport.mentorshipProgramId" 
               name="editProgramId" required min="1" #editProgramId="ngModel"
               [class.error-field]="editProgramId.invalid && (editProgramId.dirty || editProgramId.touched || formSubmitted)">
        <div *ngIf="editProgramId.invalid && (editProgramId.dirty || editProgramId.touched || formSubmitted)" class="error">
          <div *ngIf="editProgramId.errors?.['required']">Mentorship Program ID is required.</div>
          <div *ngIf="editProgramId.errors?.['min']">Mentorship Program ID must be at least 1.</div>
        </div>
      </div>
      
      <!-- Add form validation summary -->
      <div *ngIf="formSubmitted && editReportForm.invalid" class="form-error-summary">
        Please fill in all required fields correctly before submitting.
      </div>
      
      <div class="form-buttons">
        <button type="submit" class="btn-square btn-edit">‚úèÔ∏è</button>
        <button type="button" class="btn-cancel" (click)="clearSelection()">‚úñ</button>
      </div>
    </form>
  </div>

  <!-- Add progress report form -->
  <div class="progress-report-form" *ngIf="showCreateForm">
    <h3>Add New Progress Report</h3>
    <form (ngSubmit)="createProgressReport()" #reportForm="ngForm">
      <div>
        <label for="content">Content: <span class="required-field">*</span></label>
        <input id="content" [(ngModel)]="newProgressReport.reportContent" 
               name="content" required minlength="3" #content="ngModel"
               [class.error-field]="content.invalid && (content.dirty || content.touched || formSubmitted)">
        <div *ngIf="content.invalid && (content.dirty || content.touched || formSubmitted)" class="error">
          <div *ngIf="content.errors?.['required']">Content is required.</div>
          <div *ngIf="content.errors?.['minlength']">Content must be at least 3 characters long.</div>
        </div>
      </div>
      
      <div>
        <label for="reportDate">Report Date: <span class="required-field">*</span></label>
        <input id="reportDate" type="date" [(ngModel)]="reportDateString" 
               name="reportDate" required #reportDate="ngModel"
               [class.error-field]="reportDate.invalid && (reportDate.dirty || reportDate.touched || formSubmitted)">
        <div *ngIf="reportDate.invalid && (reportDate.dirty || reportDate.touched || formSubmitted)" class="error">
          <div *ngIf="reportDate.errors?.['required']">Report Date is required.</div>
        </div>
      </div>
      
      <div>
        <label for="learnerId">Learner ID: <span class="required-field">*</span></label>
        <input id="learnerId" type="number" [(ngModel)]="newProgressReport.learnerId" 
               name="learnerId" required min="1" #learnerId="ngModel"
               [class.error-field]="learnerId.invalid && (learnerId.dirty || learnerId.touched || formSubmitted)">
        <div *ngIf="learnerId.invalid && (learnerId.dirty || learnerId.touched || formSubmitted)" class="error">
          <div *ngIf="learnerId.errors?.['required']">Learner ID is required.</div>
          <div *ngIf="learnerId.errors?.['min']">Learner ID must be at least 1.</div>
        </div>
      </div>
      
      <div>
        <label for="programId">Mentorship Program ID: <span class="required-field">*</span></label>
        <input id="programId" type="number" [(ngModel)]="newProgressReport.mentorshipProgramId" 
               name="programId" required min="1" #programId="ngModel"
               [class.error-field]="programId.invalid && (programId.dirty || programId.touched || formSubmitted)">
        <div *ngIf="programId.invalid && (programId.dirty || programId.touched || formSubmitted)" class="error">
          <div *ngIf="programId.errors?.['required']">Mentorship Program ID is required.</div>
          <div *ngIf="programId.errors?.['min']">Mentorship Program ID must be at least 1.</div>
        </div>
      </div>
      
      <!-- Add form validation summary -->
      <div *ngIf="formSubmitted && reportForm.invalid" class="form-error-summary">
        Please fill in all required fields correctly before submitting.
      </div>
      
      <div class="form-buttons">
        <button type="submit" class="btn-square btn-add">‚úì</button>
        <button type="button" class="btn-cancel" (click)="resetForm()">‚úñ</button>
      </div>
    </form>
  </div>

</div>