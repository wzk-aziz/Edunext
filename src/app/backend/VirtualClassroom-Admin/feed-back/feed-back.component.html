<div class="feedback-container">
  <h2>Feedback List</h2>

  <button (click)="showCreateForm = !showCreateForm" class="add-button">
    {{ showCreateForm ? 'Cancel' : 'Add New Feedback' }}
  </button>

  <div *ngIf="showCreateForm" class="feedback-form">
    <h3>Create New Feedback</h3>
    <form (ngSubmit)="createFeedback()" #feedbackForm="ngForm">
      <label for="content">Content:</label>
      <input id="content" [(ngModel)]="newFeedback.content_feedback" name="content" required minlength="3" #content="ngModel">
      <div *ngIf="content.invalid && (content.dirty || content.touched)" class="error">
        <div *ngIf="content.errors?.['required']">Content is required.</div>
        <div *ngIf="content.errors?.['minlength']">Content must be at least 3 characters long.</div>
      </div>

      <label for="rating">Rating:</label>
      <input id="rating" type="number" [(ngModel)]="newFeedback.rating" name="rating" required min="0" max="10" #rating="ngModel">
      <div *ngIf="rating.invalid && (rating.dirty || rating.touched)" class="error">
        <div *ngIf="rating.errors?.['required']">Rating is required.</div>
        <div *ngIf="rating.errors?.['min']">Rating must be at least 0.</div>
        <div *ngIf="rating.errors?.['max']">Rating cannot be more than 10.</div>
      </div>

      <label for="session">Session ID:</label>
      <input id="session" type="number" [(ngModel)]="newFeedback.session_id" name="session" required min="1" #session="ngModel">
      <div *ngIf="session.invalid && (session.dirty || session.touched)" class="error">
        <div *ngIf="session.errors?.['required']">Session ID is required.</div>
        <div *ngIf="session.errors?.['min']">Session ID must be at least 1.</div>
      </div>

      <button type="submit" [disabled]="feedbackForm.invalid">Create</button>
    </form>
  </div>

  <div class="feedback-list">
   
    <input type="text" placeholder="Search feedbacks..." [(ngModel)]="searchTerm" (ngModelChange)="filterFeedbacks()" class="search-bar">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Content</th>
          <th>Rating</th>
          <th>Session ID</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let feedback of filteredFeedbacks">
          <td>{{ feedback.id_feedback }}</td>
          <td>{{ feedback.content_feedback }}</td>
          <td>{{ feedback.rating }}</td>
          <td>{{ feedback.session_id }}</td>
          <td>
            <button (click)="selectFeedback(feedback)">Edit</button>
            <button (click)="deleteFeedback(feedback.id_feedback)">Delete</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="selectedFeedback" class="feedback-edit">
   
    <form (ngSubmit)="updateFeedback()" #editFeedbackForm="ngForm">
      <label for="edit-content">Content:</label>
      <input id="edit-content" [(ngModel)]="selectedFeedback.content_feedback" name="editContent" required minlength="3" #editContent="ngModel">
      <div *ngIf="editContent.invalid && (editContent.dirty || editContent.touched)" class="error">
        <div *ngIf="editContent.errors?.['required']">Content is required.</div>
        <div *ngIf="editContent.errors?.['minlength']">Content must be at least 3 characters long.</div>
      </div>

      <label for="edit-rating">Rating:</label>
      <input id="edit-rating" type="number" [(ngModel)]="selectedFeedback.rating" name="editRating" required min="1" max="5" #editRating="ngModel">
      <div *ngIf="editRating.invalid && (editRating.dirty || editRating.touched)" class="error">
        <div *ngIf="editRating.errors?.['required']">Rating is required.</div>
        <div *ngIf="editRating.errors?.['min']">Rating must be at least 1.</div>
        <div *ngIf="editRating.errors?.['max']">Rating cannot be more than 5.</div>
      </div>

      <label for="edit-session">Session ID:</label>
      <input id="edit-session" type="number" [(ngModel)]="selectedFeedback.session_id" name="editSession" required min="1" #editSession="ngModel">
      <div *ngIf="editSession.invalid && (editSession.dirty || editSession.touched)" class="error">
        <div *ngIf="editSession.errors?.['required']">Session ID is required.</div>
        <div *ngIf="editSession.errors?.['min']">Session ID must be at least 1.</div>
      </div>

      <button type="submit" [disabled]="editFeedbackForm.invalid">Update</button>
      <button type="button" (click)="clearSelection()">Cancel</button>
    </form>
  </div>
</div>